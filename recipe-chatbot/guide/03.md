## Update frontend/index.html

- ·ªû ƒë√¢y ta kh√¥ng ƒë·ªÅ c·∫≠p ƒë·∫øn HTML/CSS
- Ta s·∫Ω t·∫≠p trung v√†o `script` ƒë·ªÉ vi·∫øt code giao ti·∫øp v·ªõi backend b·∫±ng Javascript

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <style>
      /* Basic, responsive chat styling */
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: #f8f9fa;
        /* Slightly lighter background */
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        height: 100vh;
      }

      #app-container {
        /* New wrapper */
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 600px;
        height: 100%;
        /* Take full height of body */
        box-sizing: border-box;
        /* padding: 0 16px; /* Remove horizontal padding here, apply to children if needed */
        background-color: #ffffff;
        /* Give app-container a white background */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        /* Subtle shadow for depth */
        border-radius: 12px;
        /* Rounded corners for the whole app box */
        overflow: hidden;
        /* To make sure children respect border-radius */
        margin: 16px;
        /* Add some margin around the app container */
      }

      #chat-container {
        /* width: 100%; /* Handled by app-container */
        /* max-width: 600px; /* Handled by app-container */
        flex: 1;
        /* Takes available space */
        display: flex;
        flex-direction: column;
        padding: 20px 20px 10px 20px;
        /* More padding */
        overflow-y: auto;
        box-sizing: border-box;
      }

      .message {
        padding: 10px 15px;
        border-radius: 18px;
        /* Softer, more modern radius */
        margin-bottom: 10px;
        max-width: 85%;
        line-height: 1.5;
      }

      .user {
        align-self: flex-end;
        background-color: #e0f0ff;
        /* Lighter, softer blue for user */
        color: #00529b;
        /* Darker blue text for contrast */
      }

      .assistant {
        align-self: flex-start;
        background-color: #f1f3f5;
        /* Lighter gray for assistant */
        color: #343a40;
        /* Darker gray text */
        border: none;
        /* Remove default border */
      }

      /* Styling for markdown elements inside assistant messages */
      .assistant p {
        margin: 0.5em 0;
      }

      .assistant ul,
      .assistant ol {
        margin: 0.5em 0 0.5em 20px;
        padding: 0;
      }

      .assistant li {
        margin-bottom: 0.25em;
      }

      .assistant pre {
        background-color: #e9ecef;
        padding: 10px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 0.9em;
      }

      .assistant code {
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        font-size: 0.9em;
        background-color: rgba(0, 0, 0, 0.04);
        padding: 2px 4px;
        border-radius: 4px;
      }

      .assistant pre code {
        background-color: transparent;
        padding: 0;
        border-radius: 0;
      }

      #typing-indicator {
        box-sizing: border-box;
        display: none;
        color: #6c757d;
        /* Subtler gray for typing */
        font-style: italic;
        padding: 10px 15px;
        /* Match message padding */
        margin-bottom: 8px;
        border-radius: 18px;
        /* Match message radius */
        background-color: #f1f3f5;
        /* Match assistant background */
        align-self: flex-start;
        /* Ensure it aligns like an assistant message */
        max-width: fit-content;
        /* Only as wide as its content */
        margin-left: 20px;
        /* Align with chat content padding */
      }

      #input-form {
        display: flex;
        align-items: center;
        /* Vertically align input and button */
        padding: 15px 20px;
        /* More padding */
        box-sizing: border-box;
        background-color: #f8f9fa;
        /* Slightly off-white for input area */
        border-top: 1px solid #dee2e6;
        /* Subtle separator line */
      }

      #user-input {
        flex: 1;
        padding: 12px 15px;
        font-size: 1rem;
        /* Consistent font size */
        border: 1px solid #ced4da;
        /* Softer border */
        border-radius: 20px;
        /* Rounded pill shape */
        margin-right: 10px;
        outline: none;
        /* Remove default focus outline */
        transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      }

      #user-input:focus {
        border-color: #4dabf7;
        /* Blue border on focus */
        box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.25);
        /* Subtle glow on focus */
      }

      #send-btn {
        padding: 12px 20px;
        font-size: 1rem;
        font-weight: 500;
        /* Slightly bolder text */
        background-color: #28a745;
        /* Green send button */
        color: #fff;
        border: none;
        border-radius: 20px;
        /* Match input field */
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }

      #send-btn:hover {
        background-color: #218838;
        /* Darker green on hover */
      }

      #send-btn:disabled {
        background-color: #adb5bd;
        /* Gray when disabled */
        cursor: not-allowed;
      }
    </style>
  </head>

  <body>
    <h2
      style="font-family: 'Inter', sans-serif; font-weight: 600; color: #343a40; margin-top: 24px; margin-bottom: 16px; text-align: center;"
    >
      Recipe Chatbot
    </h2>
    <div id="app-container">
      <!-- New wrapper -->
      <div id="chat-container">
        <!-- Messages are rendered here by renderChat -->
      </div>
      <div id="typing-indicator">Assistant is typing...</div>
      <form id="input-form">
        <input id="user-input" type="text" placeholder="Ask for a recipe..." autocomplete="off" required />
        <button id="send-btn" type="submit">Send</button>
      </form>
    </div>
    <!-- End of app-container -->

    <script>
      const form = document.getElementById("input-form");
      const input = document.getElementById("user-input");
      const chatContainer = document.getElementById("chat-container");
      const sendBtn = document.getElementById("send-btn");
      const typingIndicator = document.getElementById("typing-indicator");

      let chatHistory = []; // Holds all messages: { role: string, content: string }[]
      let typingInterval = null; // Variable to hold the interval ID

      // ...
      // ...
    </script>
  </body>
</html>
```

---

---

```js
const form = document.getElementById("input-form");
const input = document.getElementById("user-input");
const chatContainer = document.getElementById("chat-container");
const sendBtn = document.getElementById("send-btn");
const typingIndicator = document.getElementById("typing-indicator");

let chatHistory = []; // Holds all messages: { role: string, content: string }[]
let typingInterval = null; // Variable to hold the interval ID
```

### **1. DOM Elements (L·∫•y ph·∫ßn t·ª≠ HTML):**

```js
const form = document.getElementById("input-form");
const input = document.getElementById("user-input");
const chatContainer = document.getElementById("chat-container");
const sendBtn = document.getElementById("send-btn");
const typingIndicator = document.getElementById("typing-indicator");
```

- `form`: Th·∫ª `<form>` d√πng ƒë·ªÉ ch·ª©a input v√† button g·ª≠i.
- `input`: Tr∆∞·ªùng ng∆∞·ªùi d√πng nh·∫≠p tin nh·∫Øn (input box).
- `chatContainer`: V√πng hi·ªÉn th·ªã to√†n b·ªô ƒëo·∫°n chat (tin nh·∫Øn c≈© v√† m·ªõi).
- `sendBtn`: N√∫t ƒë·ªÉ g·ª≠i tin nh·∫Øn.
- `typingIndicator`: Th√¥ng b√°o (v√≠ d·ª•: "AI is typing...") hi·ªÉn th·ªã khi h·ªá th·ªëng ƒëang x·ª≠ l√Ω.

### **2. Chat State Variables (Bi·∫øn tr·∫°ng th√°i):**

```js
let chatHistory = []; // Holds all messages: { role: string, content: string }[]
```

- `chatHistory`: M·∫£ng l∆∞u l·∫°i l·ªãch s·ª≠ tr√≤ chuy·ªán. M·ªói ph·∫ßn t·ª≠ l√† m·ªôt object c√≥ d·∫°ng:

  ```js
  { role: "user" | "assistant", content: "..." }
  ```

```js
let typingInterval = null; // Variable to hold the interval ID
```

- `typingInterval`: Bi·∫øn l∆∞u `setInterval` ID, ƒë·ªÉ sau c√≥ th·ªÉ `clearInterval` khi kh√¥ng c·∫ßn n·ªØa. Th∆∞·ªùng d√πng ƒë·ªÉ m√¥ ph·ªèng hi·ªáu ·ª©ng g√µ ch·ªØ nh∆∞ `.` ‚Üí `..` ‚Üí `...`.

### T·ªïng k·∫øt:

ƒê√¢y l√† ph·∫ßn kh·ªüi t·∫°o:

- G√°n c√°c ph·∫ßn t·ª≠ HTML v√†o bi·∫øn.
- Kh·ªüi t·∫°o bi·∫øn l∆∞u l·ªãch s·ª≠ tr√≤ chuy·ªán.
- Chu·∫©n b·ªã bi·∫øn cho hi·ªáu ·ª©ng "typing...".

---

---

```js
function renderChat() {
  chatContainer.innerHTML = ""; // Clear existing messages

  chatHistory.forEach((msg) => {
    if (msg.role === "system") return;

    const bubble = document.createElement("div");
    bubble.classList.add("message", msg.role);

    if (msg.role === "assistant") {
      bubble.innerHTML = marked.parse(msg.content || ""); // Use marked.parse for assistant
    } else {
      bubble.textContent = msg.content;
    }
    chatContainer.appendChild(bubble);
  });
  chatContainer.scrollTop = chatContainer.scrollHeight;
}
```

ƒê√¢y l√† h√†m ch·ªãu tr√°ch nhi·ªám ‚Äúv·∫Ω‚Äù (render) l·∫°i to√†n b·ªô cu·ªôc tr√≤ chuy·ªán l√™n giao di·ªán:

1. **X√≥a n·ªôi dung c≈©**

   ```js
   chatContainer.innerHTML = "";
   ```

   ‚Äì M·ªói l·∫ßn g·ªçi, n√≥ ‚Äúd·ªçn‚Äù s·∫°ch `chatContainer` ƒë·ªÉ tr√°nh l·∫∑p tin nh·∫Øn.

2. **Duy·ªát qua `chatHistory`**

   ```js
   chatHistory.forEach(msg => {
     if (msg.role === "system") return;
     ‚Ä¶
   });
   ```

   ‚Äì B·ªè qua c√°c message c√≥ role l√† `system` (d√πng cho thi·∫øt l·∫≠p, kh√¥ng hi·ªÉn th·ªã).

3. **T·∫°o ‚Äúmessage bubble‚Äù**

   ```js
   const bubble = document.createElement("div");
   bubble.classList.add("message", msg.role);
   ```

   ‚Äì T·∫°o th·∫ª `<div>` m·ªõi.
   ‚Äì G√°n class `message` v√† class t∆∞∆°ng ·ª©ng `user` ho·∫∑c `assistant` ƒë·ªÉ d·ªÖ style (CSS).

4. **Ch√®n n·ªôi dung v√†o bubble**

   - V·ªõi assistant (ChatGPT):

     ```js
     bubble.innerHTML = marked.parse(msg.content || "");
     ```

     D√πng `marked.parse` ƒë·ªÉ bi·∫øn Markdown th√†nh HTML, hi·ªÉn th·ªã rich text (bold, link, code‚Ä¶).

   - V·ªõi user:

     ```js
     bubble.textContent = msg.content;
     ```

     D√πng `textContent` ƒë·ªÉ tr√°nh inject HTML, ch·ªâ hi·ªÉn th·ªã plain text.

5. **Th√™m bubble v√†o container**

   ```js
   chatContainer.appendChild(bubble);
   ```

6. **T·ª± cu·ªôn xu·ªëng tin nh·∫Øn m·ªõi nh·∫•t**

   ```js
   chatContainer.scrollTop = chatContainer.scrollHeight;
   ```

   ƒê·∫£m b·∫£o khung chat lu√¥n hi·ªÉn th·ªã tin nh·∫Øn m·ªõi nh·∫•t ·ªü d∆∞·ªõi c√πng.

---

---

```js
async function sendMessage(evt) {
  evt.preventDefault();
  const userText = input.value.trim();
  if (!userText) return;

  // Add user message to history and re-render
  chatHistory.push({ role: "user", content: userText });
  renderChat();

  input.value = "";
  input.focus();
  sendBtn.disabled = true;

  let dotCount = 0;
  typingIndicator.style.display = "block";
  typingIndicator.textContent = "Assistant is typing"; // Initial text without dots
  if (typingInterval) clearInterval(typingInterval);
  typingInterval = setInterval(() => {
    dotCount = (dotCount + 1) % 4;
    typingIndicator.textContent = `Assistant is typing${".".repeat(dotCount)}`;
  }, 300);
  typingIndicator.scrollIntoView({ behavior: "smooth", block: "end" }); // Scroll indicator into view

  try {
    // Send the whole history
    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages: chatHistory }),
    });

    if (!res.ok) {
      const errorData = await res.json();
      throw new Error(errorData.detail || `Server responded with ${res.status}`);
    }

    const data = await res.json();
    chatHistory = data.messages; // Update history with the server's version
    renderChat(); // Re-render with the full history from server
  } catch (error) {
    // Add error message to history and re-render
    chatHistory.push({
      role: "assistant",
      content: `Oops! Something went wrong: ${error.message}. Please try again.`,
      // Error message will also be parsed by marked in renderChat
    });
    renderChat();
    console.error(error);
  } finally {
    sendBtn.disabled = false;
    typingIndicator.style.display = "none";
    if (typingInterval) clearInterval(typingInterval); // Stop animation
    typingInterval = null;
  }
}
```

H√†m `sendMessage(evt)` l√† logic ch√≠nh x·ª≠ l√Ω vi·ªác g·ª≠i tin nh·∫Øn trong ·ª©ng d·ª•ng chat. ƒê√¢y l√† flow t·ªïng qu√°t khi ng∆∞·ªùi d√πng nh·∫•n Enter ho·∫∑c n√∫t G·ª≠i.

## üîç **Gi·∫£i th√≠ch chi ti·∫øt t·ª´ng b∆∞·ªõc**

### **1. NgƒÉn reload v√† x·ª≠ l√Ω input**

```js
evt.preventDefault();
const userText = input.value.trim();
if (!userText) return;
```

- NgƒÉn tr√¨nh duy·ªát g·ª≠i form theo ki·ªÉu truy·ªÅn th·ªëng (`reload`).
- L·∫•y n·ªôi dung ng∆∞·ªùi d√πng nh·∫≠p.
- N·∫øu r·ªóng th√¨ kh√¥ng l√†m g√¨ c·∫£.

### **2. Th√™m tin nh·∫Øn ng∆∞·ªùi d√πng v√†o `chatHistory` v√† hi·ªÉn th·ªã**

```js
chatHistory.push({ role: "user", content: userText });
renderChat();
```

- L∆∞u tin nh·∫Øn ng∆∞·ªùi d√πng v√†o l·ªãch s·ª≠ chat.
- G·ªçi `renderChat()` ƒë·ªÉ c·∫≠p nh·∫≠t UI.

### **3. Reset input v√† disable n√∫t G·ª≠i**

```js
input.value = "";
input.focus();
sendBtn.disabled = true;
```

- Xo√° input, focus l·∫°i ƒë·ªÉ ti·ªán g√µ ti·∫øp.
- V√¥ hi·ªáu h√≥a n√∫t g·ª≠i ƒë·ªÉ tr√°nh spam khi ƒëang ch·ªù ph·∫£n h·ªìi.

### **4. B·∫≠t hi·ªáu ·ª©ng ‚ÄúAssistant is typing‚Ä¶‚Äù**

```js
let dotCount = 0;
typingIndicator.style.display = "block";
typingIndicator.textContent = "Assistant is typing";

if (typingInterval) clearInterval(typingInterval);
typingInterval = setInterval(() => {
  dotCount = (dotCount + 1) % 4;
  typingIndicator.textContent = `Assistant is typing${".".repeat(dotCount)}`;
}, 300);
```

- Hi·ªán th√¥ng b√°o ƒëang x·ª≠ l√Ω.
- C·ª© m·ªói 300ms, n√≥ th√™m d·∫•u `.` v√†o d√≤ng ch·ªØ, l·∫∑p t·ª´ 0 ‚Üí 3 d·∫•u.

```js
typingIndicator.scrollIntoView({ behavior: "smooth", block: "end" });
```

- ƒê·∫£m b·∫£o ph·∫ßn ‚Äútyping‚Äù ƒë∆∞·ª£c cu·ªôn v√†o v√πng nh√¨n th·∫•y.

### **5. G·ª≠i to√†n b·ªô l·ªãch s·ª≠ chat l√™n server**

```js
const res = await fetch("/chat", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ messages: chatHistory }),
});
```

- G·ª≠i to√†n b·ªô `chatHistory` l√™n server endpoint `/chat`.
- D·∫°ng payload: `{ messages: [...] }`.

### **6. X·ª≠ l√Ω l·ªói n·∫øu server tr·∫£ l·ªói**

```js
if (!res.ok) {
  const errorData = await res.json();
  throw new Error(errorData.detail || `Server responded with ${res.status}`);
}
```

- N·∫øu status kh√¥ng ph·∫£i 2xx ‚Üí n√©m l·ªói v·ªõi chi ti·∫øt r√µ r√†ng.

### **7. C·∫≠p nh·∫≠t l·ªãch s·ª≠ t·ª´ server v√† re-render**

```js
const data = await res.json();
chatHistory = data.messages;
renderChat();
```

- C·∫≠p nh·∫≠t `chatHistory` b·∫±ng k·∫øt qu·∫£ t·ª´ server (c√≥ th·ªÉ bao g·ªìm c·∫£ c√¢u tr·∫£ l·ªùi c·ªßa AI).
- Hi·ªÉn th·ªã l·∫°i to√†n b·ªô chat.

### **8. N·∫øu l·ªói x·∫£y ra th√¨ hi·ªán th√¥ng b√°o l·ªói**

```js
catch (error) {
  chatHistory.push({
    role: "assistant",
    content: `Oops! Something went wrong: ${error.message}. Please try again.`
  });
  renderChat();
  console.error(error);
}
```

- N·∫øu l·ªói th√¨ th√™m tin nh·∫Øn l·ªói t·ª´ ph√≠a assistant v√†o.
- V·∫´n render l·∫°i ƒë·ªÉ ng∆∞·ªùi d√πng th·∫•y r√µ.

### **9. Lu√¥n lu√¥n d·ªçn d·∫πp sau khi g·ª≠i xong**

```js
finally {
  sendBtn.disabled = false;
  typingIndicator.style.display = "none";
  if (typingInterval) clearInterval(typingInterval);
  typingInterval = null;
}
```

- B·∫≠t l·∫°i n√∫t g·ª≠i.
- ·∫®n d√≤ng ‚Äútyping...‚Äù.
- D·ª´ng hi·ªáu ·ª©ng d·∫•u ch·∫•m n·∫øu c√≤n ƒëang ch·∫°y.

## ‚úÖ **T√≥m t·∫Øt**

| Giai ƒëo·∫°n              | M·ª•c ƒë√≠ch                       |
| ---------------------- | ------------------------------ |
| NgƒÉn reload, l·∫•y input | Chu·∫©n b·ªã d·ªØ li·ªáu               |
| C·∫≠p nh·∫≠t UI            | Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng   |
| B·∫≠t hi·ªáu ·ª©ng typing    | Feedback cho user              |
| G·ª≠i d·ªØ li·ªáu l√™n server | L·∫•y c√¢u tr·∫£ l·ªùi t·ª´ AI          |
| C·∫≠p nh·∫≠t l·∫°i UI        | Hi·ªÉn th·ªã k·∫øt qu·∫£               |
| D·ªçn d·∫πp                | Chu·∫©n b·ªã cho l·∫ßn g·ª≠i ti·∫øp theo |
