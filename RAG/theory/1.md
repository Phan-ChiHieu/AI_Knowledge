# RAG â€“ Retrieval-Augmented Generation

## SÆ¡ lÆ°á»£c vá» cÃ¡c chat ai cÃ³ trÃªn thá»‹ trÆ°á»ng

- SÆ¡ lÆ°á»£c trÃªn thá»‹ trÆ°á»ng Ä‘ang cÃ³ nhiá»u loáº¡i AI nhÆ°: ChatGPT, Gemini, Claude AI, Grok.

- Táº¥t cáº£ cÃ¡c AI trÃªn Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch kiáº¿m má»™t lÆ°á»£ng lá»›n data (Big Data) gÃ´m text, image

- Sau Ä‘Ã³ há» TRAIN cho con LLM cho nÃ³ thÃ´ng minh. VÃ­ dá»¥ LLM cá»§a ChatGPT lÃ  GPT4o, GPT3.5,...

- **Khi huáº¥n luyá»‡n vá»›i lÆ°á»£ng lá»›n dá»¯ liá»‡u, LLM cÃ³ váº» â€œhiá»ƒu biáº¿tâ€, nhÆ°ng tháº­t ra chá»‰ lÃ  "Ä‘oÃ¡n Ä‘Ãºng tá»« tiáº¿p theo" dá»±a vÃ o ngá»¯ cáº£nh.**

![Images Demo](./images/llm/1.webp)

### VÃ­ dá»¥ 1:

- Táº¡i sao láº¡i chá»n **playground** nhÆ° hÃ¬nh --> vÃ¬ tá»« **playground** lÃºc mÃ  nÃ³ predict (dá»± Ä‘oÃ¡n) thÃ¬ nÃ³ cÃ³ cÃ¡i probability (xÃ¡c suáº¥t) lÃ  cÃ¡i kháº£ nÄƒng lÃ  cao nháº¥t -> VÃ¬ trong Big Data thÃ¬ nhá»¯ng cÃ¢u **the boy want to go to playground** xuáº¥t hiá»‡n nhiá»u nháº¥t nÃªn probability (xÃ¡c suáº¥t) cao

- Náº¿u ta dÃ¹ng táº­p dá»¯ liá»‡u khÃ¡c mÃ  **he boy want to go to school** xuáº¥t hiá»‡n nhiá»u hÆ¡n thÃ¬ sáº½ predict (dá»± Ä‘oÃ¡n) **school**

### VÃ­ dá»¥ 2:

- input: Thá»§ ÄÃ´ Viá»‡t Nam lÃ  gÃ¬ ?
- output: Thá»§ Ä‘á»™ Viá»‡t Nam lÃ  HÃ  Ná»™i

==> CÃ³ Ä‘oÃ¡n tá»« khÃ´ng ? **CÃ“**

==> Dá»±a vÃ o tá»«ng tá»« trong input Ä‘á»ƒ Ä‘oÃ¡n ra Ä‘oáº¡n output.

==> Táº¡i sao lÃ m Ä‘Æ°á»£c kiá»ƒu há»i Ä‘Ã¡p nhÆ° váº­y. Nhá»¯ng LLM lÃ m Ä‘Æ°á»£c kiá»ƒu nhÆ° váº­y Ä‘Ã£ Ä‘Æ°á»£c fine-tune láº¡i rá»“i.

==> Sau khi train má»™t dá»¯ liá»‡u cá»±c lá»›n Big Data thÃ¬ tiáº¿p Ä‘Ã³ ngÆ°á»i ta fine-tune báº±ng cÃ¡c cáº·p cÃ¢u há»i - tráº£ lá»i, cÃ¢u há»i - tráº£ lá»i

==> VÃ  tá»« Ä‘Ã³ lÃ m LLM tá»‘t nhiá»‡m vá»¥ tráº£ lá»i ngÆ°á»i dÃ¹ng.

### AI tráº£ lá»i:

#### ğŸ”¹ **Input: "Thá»§ Ä‘Ã´ Viá»‡t Nam lÃ  gÃ¬?" â†’ Output: "Thá»§ Ä‘Ã´ Viá»‡t Nam lÃ  HÃ  Ná»™i"**

> âœ… CÃ³ Ä‘oÃ¡n tá»« khÃ´ng? â†’ **CÃ“.**
> LLM khÃ´ng **tra cá»©u** cÃ¢u tráº£ lá»i, mÃ  **dá»± Ä‘oÃ¡n** tá»«ng tá»« tiáº¿p theo dá»±a trÃªn xÃ¡c suáº¥t cao nháº¥t tá»« dá»¯ liá»‡u huáº¥n luyá»‡n.

- NÃ³ "biáº¿t" cÃ¢u tráº£ lá»i vÃ¬ Ä‘Ã£ tháº¥y cÃ¡c dáº¡ng cÃ¢u tÆ°Æ¡ng tá»± nhiá»u láº§n trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n.
- Tá»©c lÃ : `"Thá»§ Ä‘Ã´ Viá»‡t Nam lÃ "` â†’ mÃ´ hÃ¬nh Ä‘Ã£ há»c Ä‘Æ°á»£c ráº±ng `"HÃ  Ná»™i"` thÆ°á»ng xuyÃªn Ä‘i sau cá»¥m nÃ y.

#### ğŸ”¹ **Dá»±a vÃ o tá»«ng tá»« trong input Ä‘á»ƒ Ä‘oÃ¡n output?**

> âœ… **ÄÃºng.**
> LLM dÃ¹ng cÆ¡ cháº¿ attention (nhÆ° trong Transformer) Ä‘á»ƒ **xem xÃ©t toÃ n bá»™ chuá»—i input** khi táº¡o ra tá»«ng tá»« trong output.

- KhÃ´ng pháº£i chá»‰ tá»« cuá»‘i, mÃ  lÃ  toÃ n bá»™ cÃ¢u, tháº­m chÃ­ cáº£ Ä‘oáº¡n trÆ°á»›c trong há»™i thoáº¡i.

#### ğŸ”¹ **Táº¡i sao lÃ m Ä‘Æ°á»£c há»i - Ä‘Ã¡p nhÆ° váº­y?**

> âœ… **VÃ¬ Ä‘Ã£ Ä‘Æ°á»£c fine-tune báº±ng cáº·p Q\&A.**

- Sau khi pretrain trÃªn dá»¯ liá»‡u ráº¥t lá»›n (big data), LLM váº«n chÆ°a thá»±c sá»± â€œgiá»iâ€ á»Ÿ cÃ¡c task cá»¥ thá»ƒ nhÆ° há»i - Ä‘Ã¡p, viáº¿t code, tÃ³m táº¯t...
- VÃ¬ váº­y, cÃ¡c hÃ£ng (OpenAI, Anthropic...) thá»±c hiá»‡n bÆ°á»›c **fine-tuning**:

  - DÃ¹ng bá»™ dá»¯ liá»‡u cÃ³ cáº¥u trÃºc: _CÃ¢u há»i â€“ Tráº£ lá»i._
  - Hoáº·c tháº­m chÃ­ dÃ¹ng ká»¹ thuáº­t **RLHF (Reinforcement Learning from Human Feedback)** Ä‘á»ƒ mÃ´ hÃ¬nh tráº£ lá»i giá»‘ng con ngÆ°á»i hÆ¡n, biáº¿t "nÃ³i chuyá»‡n".

#### ğŸ”¹ **Tá»« Ä‘Ã³ LLM má»›i giá»i há»i - Ä‘Ã¡p**

> âœ… **ChÃ­nh xÃ¡c.**

- ChÃ­nh cÃ¡c bÆ°á»›c fine-tune (vÃ  sau Ä‘Ã³ lÃ  RLHF hoáº·c instruction-tuning) má»›i lÃ m cho LLM biáº¿t cÃ¡ch tráº£ lá»i rÃµ rÃ ng, máº¡ch láº¡c.
- Náº¿u chá»‰ dá»«ng á»Ÿ bÆ°á»›c pretrain thÃ¬ mÃ´ hÃ¬nh cÃ³ thá»ƒ biáº¿t nhiá»u thÃ´ng tin, nhÆ°ng **tráº£ lá»i sáº½ khÃ´ng gá»n gÃ ng, khÃ´ng biáº¿t giá»¯ Ä‘á»‹nh dáº¡ng, khÃ´ng hiá»ƒu yÃªu cáº§u.**

#### âœ… **TÃ³m láº¡i:**

> ğŸ”¸ LLM biáº¿t tráº£ lá»i vÃ¬:

> **(1)** Há»c tá»« dá»¯ liá»‡u lá»›n â†’ Biáº¿t xÃ¡c suáº¥t tá»« ngá»¯

> **(2)** ÄÆ°á»£c fine-tune báº±ng dá»¯ liá»‡u Q\&A â†’ Biáº¿t cÃ¡ch pháº£n há»“i Ä‘Ãºng cÃ¢u há»i

> **(3)** CÃ³ cÆ¡ cháº¿ attention â†’ PhÃ¢n tÃ­ch toÃ n bá»™ cÃ¢u Ä‘á»ƒ dá»± Ä‘oÃ¡n tá»« tiáº¿p theo

---

## Why RAG & What RAG

CÃ¢u há»i ráº¥t trá»ng tÃ¢m: **Náº¿u LLM Ä‘Ã£ thÃ´ng minh vÃ  biáº¿t tráº£ lá»i thÃ¬ táº¡i sao cÃ²n cáº§n RAG?**

## âœ… **1. VÃ¬ LLM _khÃ´ng biáº¿t dá»¯ liá»‡u má»›i, riÃªng, ná»™i bá»™_**

> DÃ¹ LLM Ä‘Æ°á»£c huáº¥n luyá»‡n vá»›i dá»¯ liá»‡u ráº¥t lá»›n, nhÆ°ng:

- NÃ³ **khÃ´ng biáº¿t thÃ´ng tin sau thá»i Ä‘iá»ƒm huáº¥n luyá»‡n** (cut-off date).
- NÃ³ **khÃ´ng biáº¿t dá»¯ liá»‡u ná»™i bá»™ cá»§a tá»• chá»©c/cÃ´ng ty báº¡n**.
- NÃ³ **khÃ´ng biáº¿t vÄƒn báº£n báº¡n Ä‘ang xá»­ lÃ½**, vÃ­ dá»¥ nhÆ° há»£p Ä‘á»“ng, bÃ¡o cÃ¡o, file PDF, ná»™i quy cÃ´ng ty...

ğŸ§  **LLM = thÃ´ng minh tá»•ng quÃ¡t (general)**
ğŸ“š **RAG = cung cáº¥p kiáº¿n thá»©c cá»¥ thá»ƒ (domain knowledge)**

## âœ… **2. VÃ¬ LLM khÃ´ng thá»ƒ nhá»› toÃ n bá»™ tháº¿ giá»›i**

- KhÃ´ng thá»ƒ nhá»“i toÃ n bá»™ tri thá»©c vÃ o mÃ´ hÃ¬nh (cáº£ vá» giá»›i háº¡n token, cáº£ vá» kháº£ nÄƒng há»c).
- Vá»›i nhá»¯ng thÃ´ng tin chi tiáº¿t nhÆ°:

  - **ChÃ­nh sÃ¡ch cÃ´ng ty**
  - **Sáº£n pháº©m ná»™i bá»™**
  - **Luáº­t phÃ¡p Ä‘á»‹a phÆ°Æ¡ng**
  - **Sá»‘ liá»‡u tÃ i chÃ­nh**

  âœ Cháº¯c cháº¯n **LLM khÃ´ng cÃ³**, mÃ  pháº£i **truy xuáº¥t (retrieve)**.

## âœ… **3. VÃ¬ RAG giÃºp cáº­p nháº­t theo thá»i gian thá»±c**

- Náº¿u cÃ´ng ty báº¡n thay Ä‘á»•i chÃ­nh sÃ¡ch hÃ´m qua â†’ khÃ´ng thá»ƒ fine-tune láº¡i GPT ngay.
- Vá»›i RAG, báº¡n chá»‰ cáº§n:

  - **Cáº­p nháº­t vÄƒn báº£n vÃ o vector DB**
  - â†’ LLM dÃ¹ng thÃ´ng tin má»›i ngay láº­p tá»©c

â± KhÃ´ng cáº§n retrain, khÃ´ng cáº§n fine-tune, nhanh gá»n.

## âœ… **4. VÃ¬ RAG giÃºp kiá»ƒm soÃ¡t nguá»“n thÃ´ng tin**

- Vá»›i RAG, báº¡n biáº¿t: â€œCÃ¢u tráº£ lá»i nÃ y Ä‘áº¿n tá»« Ä‘oáº¡n vÄƒn báº£n nÃ o?â€
- GiÃºp:

  - **Giáº£i thÃ­ch Ä‘Æ°á»£c (explainability)**
  - **TrÃ¡nh bá»‹a (hallucination)**: vÃ¬ LLM bá»‹ Ã©p chá»‰ dÃ¹ng Ä‘Ãºng tÃ i liá»‡u Ä‘Æ°á»£c Ä‘Æ°a vÃ o.

## âœ… **5. VÃ¬ RAG ráº» hÆ¡n nhiá»u so vá»›i fine-tune**

- Fine-tune LLM cáº§n GPU, tiá»n, thá»i gian â†’ khÃ´ng pháº£i ai cÅ©ng lÃ m Ä‘Æ°á»£c.
- RAG chá»‰ cáº§n: embedding + vector DB (nhÆ° FAISS, Qdrant...) + 1 LLM nhÆ° GPT-4 â†’ xong.

## âœ… **TÃ³m láº¡i, cáº§n RAG vÃ¬:**

| LÃ½ do                                | Giáº£i thÃ­ch                                       |
| ------------------------------------ | ------------------------------------------------ |
| ğŸ§  KhÃ´ng biáº¿t dá»¯ liá»‡u ná»™i bá»™         | LLM khÃ´ng â€œbiáº¿tâ€ vÄƒn báº£n, tÃ i liá»‡u riÃªng cá»§a báº¡n |
| ğŸ“… KhÃ´ng cáº­p nháº­t thá»i gian thá»±c     | LLM khÃ´ng thá»ƒ biáº¿t dá»¯ liá»‡u sau ngÃ y cut-off      |
| ğŸ’¸ Fine-tune Ä‘áº¯t Ä‘á», khÃ³ lÃ m         | RAG nhanh, ráº», dá»… triá»ƒn khai                     |
| ğŸ“š Truy xuáº¥t Ä‘Ãºng ná»™i dung cáº§n thiáº¿t | KhÃ´ng cáº§n Ä‘Æ°a cáº£ tÃ i liá»‡u vÃ o prompt             |
| âŒ Giáº£m bá»‹a, tÄƒng tin cáº­y            | Chá»‰ tráº£ lá»i dá»±a trÃªn dá»¯ liá»‡u báº¡n cung cáº¥p        |

ğŸ‘‰ **RAG = cÃ¡ch biáº¿n LLM thÃ nh chuyÃªn gia hiá»ƒu dá»¯ liá»‡u riÃªng cá»§a báº¡n.**

KhÃ´ng RAG â†’ LLM chá»‰ lÃ  má»™t â€œÃ´ng nÃ³i hayâ€ nhÆ°ng khÃ´ng biáº¿t chuyá»‡n trong nhÃ  báº¡n.

---

## How RAG ?

### 1. Document ?

#### âœ… Document trong RAG lÃ  gÃ¬?

Trong bá»‘i cáº£nh cá»§a RAG, **Document** khÃ´ng chá»‰ lÃ  file nhÆ° PDF hay Word, mÃ  lÃ  **Ä‘Æ¡n vá»‹ chá»©a thÃ´ng tin cÃ³ thá»ƒ Ä‘Æ°á»£c truy váº¥n vÃ  dÃ¹ng lÃ m context cho LLM**.

---

## ğŸ¯ CÃ³ 2 khÃ¡i niá»‡m quan trá»ng cáº§n phÃ¢n biá»‡t:

| KhÃ¡i niá»‡m             | Ã nghÄ©a                                                                            |
| --------------------- | ---------------------------------------------------------------------------------- |
| ğŸ“„ **Document (thÃ´)** | TÃ i liá»‡u Ä‘áº§u vÃ o gá»‘c: PDF, DOCX, TXT, HTML, JSON, website...                       |
| ğŸ“‘ **Chunk (Ä‘oáº¡n)**   | Äoáº¡n vÄƒn báº£n Ä‘Æ°á»£c tÃ¡ch ra tá»« document, cÃ³ kÃ­ch thÆ°á»›c nhá» phÃ¹ há»£p Ä‘á»ƒ Ä‘Æ°a vÃ o prompt |

#### ğŸ“Œ CÃ¡c loáº¡i Document phá»• biáº¿n dÃ¹ng trong RAG:

1. **PDF**: bÃ¡o cÃ¡o tÃ i chÃ­nh, há»£p Ä‘á»“ng, ná»™i quy cÃ´ng ty
2. **Word (DOCX)**: biá»ƒu máº«u, vÄƒn báº£n hÃ nh chÃ­nh
3. **TXT / Markdown**: hÆ°á»›ng dáº«n ká»¹ thuáº­t, tÃ i liá»‡u láº­p trÃ¬nh
4. **HTML / Web page**: trang FAQ, chÃ­nh sÃ¡ch sáº£n pháº©m
5. **Email / Chat Logs**: dá»¯ liá»‡u ná»™i bá»™, há»i Ä‘Ã¡p nhÃ¢n sá»±
6. **JSON / CSV**: data bÃ¡n cáº¥u trÃºc nhÆ° sáº£n pháº©m, há»c sinh, lá»‹ch...

#### ğŸ§  VÃ¬ sao khÃ´ng Ä‘Æ°a nguyÃªn file vÃ o LLM?

- KhÃ´ng Ä‘á»§ **token limit** â†’ GPT-4 Turbo chá»‰ nháº­n \~128k tokens, trong khi file ná»™i quy cÃ³ thá»ƒ dÃ i hÃ ng trÄƒm ngÃ n tá»«.
- KhÃ´ng hiá»‡u quáº£: LLM chá»‰ cáº§n **má»™t Ä‘oáº¡n liÃªn quan**, khÃ´ng cáº§n toÃ n bá»™ vÄƒn báº£n.

#### ğŸ§° CÃ¡ch xá»­ lÃ½ Document trong RAG:

| BÆ°á»›c                     | CÃ´ng cá»¥                                                 | Ghi chÃº                                |
| ------------------------ | ------------------------------------------------------- | -------------------------------------- |
| 1. Äá»c file              | `pdfplumber`, `PyMuPDF`, `python-docx`, `BeautifulSoup` | TrÃ­ch vÄƒn báº£n                          |
| 2. Chia chunk            | `LangChain.TextSplitter`, hoáº·c chia theo Ä‘oáº¡n/tokens    | KÃ­ch thÆ°á»›c chunk thÆ°á»ng 300â€“500 tokens |
| 3. Táº¡o embedding         | OpenAI, Cohere, BGE, SentenceTransformer                | Vector hÃ³a ná»™i dung tá»«ng chunk         |
| 4. LÆ°u vector + raw text | FAISS, Qdrant, Weaviate...                              | Phá»¥c vá»¥ truy váº¥n vá» sau                |

## âœ… TÃ³m táº¯t:

> **Document = tÃ i liá»‡u chá»©a tri thá»©c mÃ  LLM cáº§n biáº¿t thÃªm**
> Trong RAG, ta:

- **Chuyá»ƒn document thÃ nh cÃ¡c Ä‘oáº¡n nhá»**
- **Táº¡o embedding cho má»—i Ä‘oáº¡n**
- **LÆ°u Ä‘á»ƒ tÃ¬m láº¡i Ä‘Ãºng lÃºc cáº§n tráº£ lá»i**

---

### 2. Vector DB ?

### âœ… Vector DB trong RAG

#### 1. ğŸ”¹ **Vector DB lÃ  gÃ¬?**

**Vector Database** lÃ  **cÆ¡ sá»Ÿ dá»¯ liá»‡u lÆ°u trá»¯ vÃ  truy váº¥n cÃ¡c vector** â€“ tá»©c lÃ  cÃ¡c dÃ£y sá»‘ thá»±c Ä‘áº¡i diá»‡n cho Ã½ nghÄ©a cá»§a Ä‘oáº¡n vÄƒn báº£n (embedding).

- Má»—i Ä‘oáº¡n vÄƒn báº£n (chunk) â†’ chuyá»ƒn thÃ nh **vector** (vÃ­ dá»¥: 1536 chiá»u).
- CÃ¡c vector nÃ y **khÃ´ng thá»ƒ tÃ¬m kiáº¿m báº±ng SQL thÃ´ng thÆ°á»ng**, vÃ¬ ta cáº§n tÃ¬m theo â€œÄ‘á»™ gáº§n vá» ngá»¯ nghÄ©aâ€.

ğŸ“Œ Vector DB giÃºp ta tÃ¬m:

> **â€œÄoáº¡n vÄƒn báº£n nÃ o gáº§n nghÄ©a nháº¥t vá»›i cÃ¢u há»i ngÆ°á»i dÃ¹ng?â€**

#### 2. ğŸ”¹ **Vector DB hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?**

#### BÃªn trong Vector DB gá»“m 3 thÃ nh pháº§n chÃ­nh:

| ThÃ nh pháº§n      | Ã nghÄ©a                                                        |
| --------------- | -------------------------------------------------------------- |
| ğŸ“ˆ **Vector**   | Embedding cá»§a Ä‘oáº¡n vÄƒn báº£n (1 dÃ£y sá»‘ float)                    |
| ğŸ§¾ **Raw text** | Ná»™i dung gá»‘c: Ä‘oáº¡n vÄƒn báº£n thÃ´                                 |
| ğŸ· **Metadata**  | Dá»¯ liá»‡u phá»¥: file nguá»“n, vá»‹ trÃ­, ngÆ°á»i dÃ¹ng, quyá»n truy cáº­p... |

#### 3. ğŸ”¹ **Khi nÃ o dÃ¹ng Vector DB?** (Trong flow RAG)

#### Khi ngÆ°á»i dÃ¹ng gá»­i cÃ¢u há»i:

1. CÃ¢u há»i â†’ táº¡o embedding vector (giá»‘ng nhÆ° document).
2. Vector DB dÃ¹ng thuáº­t toÃ¡n **Approximate Nearest Neighbors (ANN)** Ä‘á»ƒ tÃ¬m **K vector gáº§n nháº¥t**.
3. Láº¥y láº¡i cÃ¡c Ä‘oáº¡n vÄƒn báº£n gá»‘c tÆ°Æ¡ng á»©ng â†’ Ä‘Æ°a vÃ o prompt â†’ gá»­i Ä‘áº¿n LLM.

#### 4. ğŸ”¹ **Má»™t sá»‘ Vector DB phá»• biáº¿n hiá»‡n nay**

| TÃªn              | TÃ­nh nÄƒng ná»•i báº­t                     | Ghi chÃº                       |
| ---------------- | ------------------------------------- | ----------------------------- |
| **FAISS** (Meta) | Nhanh, nháº¹, local                     | PhÃ¹ há»£p demo, dá»± Ã¡n nhá»       |
| **Qdrant**       | Open-source, há»— trá»£ filter + REST API | Tá»‘t cho production            |
| **Weaviate**     | TÃ­ch há»£p semantic search, GraphQL     | CÃ³ thá»ƒ nhÃºng external data    |
| **Pinecone**     | SaaS, hiá»‡u suáº¥t cao, scale tá»‘t        | DÃ¹ng trong nhiá»u há»‡ thá»‘ng lá»›n |
| **Milvus**       | Tá»‘i Æ°u cho dá»¯ liá»‡u lá»›n                | Do Zilliz phÃ¡t triá»ƒn          |

#### 5. ğŸ”¹ HÃ¬nh dung Vector DB nhÆ° tháº¿ nÃ y:

RÃµ rÃ ng. DÆ°á»›i Ä‘Ã¢y lÃ  **vÃ­ dá»¥ cá»¥ thá»ƒ liÃªn quan trá»±c tiáº¿p Ä‘áº¿n báº£ng báº¡n Ä‘Æ°a ra**. MÃ¬nh sáº½ giá»¯ nguyÃªn cáº¥u trÃºc báº£ng, má»Ÿ rá»™ng thÃªm **2 hÃ ng ná»¯a**, vÃ  thÃªm vÃ­ dá»¥ cÃ¢u há»i â†’ chá»n dÃ²ng nÃ o.

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€--------------â”
â”‚  Vector    â”‚ Raw Text                                                   â”‚ Metadata                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€--------------â”¤
â”‚ [0.12,     â”‚ â€œNhÃ¢n viÃªn thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ 1 ngÃ y phÃ©p má»—i thÃ¡ng.â€      â”‚ {doc_id: "hr", page: 3, role: "user"}      â”‚
â”‚  0.98,...] â”‚                                                            â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€--------------â”¤
â”‚ [0.45,     â”‚ â€œNhÃ¢n viÃªn chÃ­nh thá»©c Ä‘Æ°á»£c nghá»‰ 12 ngÃ y phÃ©p má»—i nÄƒm.â€     â”‚ {doc_id: "hr", page: 5,role: "user}        â”‚
â”‚  0.65,...] â”‚                                                            â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€--------------â”¤
â”‚ [0.77,     â”‚ â€œThá»i gian thá»­ viá»‡c tá»‘i Ä‘a lÃ  2 thÃ¡ng Ä‘á»‘i vá»›i nhÃ¢n viÃªn.â€  â”‚ {doc_id: "hr", page: 2,role: "user}        â”‚
â”‚  0.34,...] â”‚                                                            â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€--------------â”¤
```

### âœ… CÃ¡c vÃ­ dá»¥ truy váº¥n & káº¿t quáº£ tÃ¬m hÃ ng:

| ğŸ§  **User há»i**                                     | ğŸ” **So khá»›p ná»™i dung**                             | âœ… **Row phÃ¹ há»£p** |
| --------------------------------------------------- | --------------------------------------------------- | ------------------ |
| â€œThá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ bao nhiÃªu ngÃ y phÃ©p má»—i thÃ¡ng?â€ | Gáº§n nháº¥t vá»›i Raw Text nÃ³i vá» **nghá»‰ phÃ©p thá»­ viá»‡c** | ğŸ‘‰ **Row 1**       |
| â€œNhÃ¢n viÃªn chÃ­nh thá»©c Ä‘Æ°á»£c bao nhiÃªu ngÃ y phÃ©p?â€    | Gáº§n nháº¥t vá»›i Ä‘oáº¡n vá» **12 ngÃ y phÃ©p má»—i nÄƒm**       | ğŸ‘‰ **Row 2**       |
| â€œThá»­ viá»‡c tá»‘i Ä‘a máº¥y thÃ¡ng?â€                        | Gáº§n nháº¥t vá»›i Ä‘oáº¡n nÃ³i **thá»­ viá»‡c tá»‘i Ä‘a 2 thÃ¡ng**   | ğŸ‘‰ **Row 3**       |

### âœ… TÃ³m gá»n flow xá»­ lÃ½:

1. NgÆ°á»i dÃ¹ng há»i: `"Thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ bao nhiÃªu ngÃ y?"`
2. CÃ¢u há»i Ä‘Æ°á»£c nhÃºng thÃ nh vector â†’ so sÃ¡nh vá»›i 3 vector trong báº£ng.
3. Cosine similarity cho tháº¥y **vector Row 1 gáº§n nháº¥t** â†’ láº¥y Ä‘oáº¡n text Ä‘Ã³.
4. ÄÆ°a Ä‘oáº¡n Ä‘Ã³ vÃ o prompt â†’ LLM tráº£ lá»i:

   > â€œNhÃ¢n viÃªn thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ 1 ngÃ y phÃ©p má»—i thÃ¡ng.â€

#### 6. ğŸ” CÃ¡c thuáº­t toÃ¡n Ä‘o Ä‘á»™ gáº§n vector (vector similarity):

| Thuáº­t toÃ¡n         | á»¨ng dá»¥ng                            |
| ------------------ | ----------------------------------- |
| Cosine similarity  | Phá»• biáº¿n nháº¥t (gÃ³c giá»¯a hai vector) |
| Euclidean distance | Khoáº£ng cÃ¡ch Ä‘Æ°á»ng tháº³ng             |
| Dot product        | Khi cÃ¡c vector Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hÃ³a    |

## âœ… TÃ³m táº¯t:

> **Vector DB lÃ  nÆ¡i lÆ°u trá»¯ tri thá»©c dÆ°á»›i dáº¡ng vector Ä‘á»ƒ LLM cÃ³ thá»ƒ â€œnhá»› láº¡iâ€ Ä‘Ãºng chá»—, Ä‘Ãºng lÃºc.**
> KhÃ´ng cÃ³ Vector DB â†’ LLM khÃ´ng thá»ƒ biáº¿t Ä‘oáº¡n nÃ o liÃªn quan Ä‘áº¿n cÃ¢u há»i.

---

### 3. Chunking ?

**Chunking** lÃ  quÃ¡ trÃ¬nh **chia nhá» tÃ i liá»‡u (document)** thÃ nh cÃ¡c **Ä‘oáº¡n vÄƒn báº£n ngáº¯n (chunk)** trÆ°á»›c khi nhÃºng (embedding) vÃ o Vector DB.

## ğŸ”¹ **VÃ¬ sao cáº§n chunking?**

1. **MÃ´ hÃ¬nh chá»‰ embed Ä‘Æ°á»£c má»™t lÆ°á»£ng token giá»›i háº¡n** (vÃ­ dá»¥ 512 hoáº·c 1024 token/lÆ°á»£t).
2. Náº¿u khÃ´ng chia, embedding cáº£ tÃ i liá»‡u dÃ i â†’ **máº¥t ngá»¯ cáº£nh, gÃ¢y nhiá»…u**.
3. Chunking giÃºp:

   - Gáº¯n metadata cá»¥ thá»ƒ cho tá»«ng pháº§n (vÃ­ dá»¥: `page: 3`, `section: 4.2`)
   - TÄƒng kháº£ nÄƒng tÃ¬m Ä‘Ãºng Ä‘oáº¡n khi search
   - TrÃ¡nh máº¥t thÃ´ng tin vÃ¬ quÃ¡ dÃ i

## ğŸ”¹ **VÃ­ dá»¥ minh há»a**

### ğŸ“„ TÃ i liá»‡u gá»‘c:

```text
Trang 1:
â€œChÃ­nh sÃ¡ch nghá»‰ phÃ©p: NhÃ¢n viÃªn chÃ­nh thá»©c Ä‘Æ°á»£c nghá»‰ 12 ngÃ y phÃ©p/nÄƒm. NhÃ¢n viÃªn thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ 1 ngÃ y phÃ©p/thÃ¡ng.â€

Trang 2:
â€œThá»i gian thá»­ viá»‡c tá»‘i Ä‘a lÃ  2 thÃ¡ng. Trong thá»i gian nÃ y, lÆ°Æ¡ng thá»­ viá»‡c cÃ³ thá»ƒ tháº¥p hÆ¡n 85% lÆ°Æ¡ng chÃ­nh thá»©c.â€
```

### ğŸ”¹ Chunking káº¿t quáº£:

| Chunk | Raw Text                                               | Metadata                    |
| ----- | ------------------------------------------------------ | --------------------------- |
| #1    | â€œNhÃ¢n viÃªn chÃ­nh thá»©c Ä‘Æ°á»£c nghá»‰ 12 ngÃ y phÃ©p/nÄƒm.â€     | {doc_id: "policy", page: 1} |
| #2    | â€œNhÃ¢n viÃªn thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ 1 ngÃ y phÃ©p/thÃ¡ng.â€      | {doc_id: "policy", page: 1} |
| #3    | â€œThá»i gian thá»­ viá»‡c tá»‘i Ä‘a lÃ  2 thÃ¡ng.â€                | {doc_id: "policy", page: 2} |
| #4    | â€œLÆ°Æ¡ng thá»­ viá»‡c cÃ³ thá»ƒ tháº¥p hÆ¡n 85% lÆ°Æ¡ng chÃ­nh thá»©c.â€ | {doc_id: "policy", page: 2} |

## ğŸ”¹ CÃ¡c phÆ°Æ¡ng phÃ¡p chunking phá»• biáº¿n

| CÃ¡ch chunk            | MÃ´ táº£ ngáº¯n                                           | Khi nÃ o dÃ¹ng                  |
| --------------------- | ---------------------------------------------------- | ----------------------------- |
| **By paragraph**      | Má»—i Ä‘oáº¡n vÄƒn lÃ  1 chunk                              | Vá»›i vÄƒn báº£n logic, ká»¹ thuáº­t   |
| **By fixed-length**   | Cáº¯t theo token (VD: 200 tokens/chunk)                | Vá»›i ná»™i dung khÃ´ng cÃ³ Ä‘oáº¡n rÃµ |
| **Sliding window**    | Cáº¯t chá»“ng láº¥n (VD: chunk 1: 0-200, chunk 2: 100-300) | Giá»¯ ngá»¯ cáº£nh liÃªn tá»¥c         |
| **Semantic chunking** | Chia theo chá»§ Ä‘á»/Ã½ nghÄ©a gáº§n nhau (dÃ¹ng NLP)         | Khi cáº§n Ä‘á»™ chÃ­nh xÃ¡c cao nháº¥t |

## âœ… TÃ³m táº¯t:

> **Chunking** lÃ  bÆ°á»›c Ä‘áº§u tiÃªn quan trá»ng trong RAG, giÃºp **cáº¯t tÃ i liá»‡u lá»›n thÃ nh tá»«ng Ä‘oáº¡n nhá» cÃ³ nghÄ©a**, sau Ä‘Ã³ Ä‘em Ä‘i nhÃºng vÃ  lÆ°u vÃ o Vector DB.

---

### 4. Retrieve ?

### âœ… **Retrieve** lÃ  gÃ¬ trong RAG?

**Retrieve (truy váº¥n)** lÃ  bÆ°á»›c láº¥y ra nhá»¯ng Ä‘oáº¡n vÄƒn báº£n (chunk) **liÃªn quan nháº¥t Ä‘áº¿n cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng**, dá»±a trÃªn sá»± giá»‘ng nhau vá» Ã½ nghÄ©a (semantic similarity) giá»¯a **vector cÃ¢u há»i** vÃ  **vector cÃ¡c chunk Ä‘Ã£ lÆ°u trong Vector DB**.

## ğŸ” Vá»‹ trÃ­ cá»§a Retrieve trong pipeline RAG:

```mermaid
graph LR
A[Document] --> B[Chunking]
B --> C[Embedding]
C --> D[Vector DB]
E[User Query] --> F[Embedding Query]
F --> G[Retrieve Top-K Chunks]
G --> H[Combine with Prompt â†’ LLM tráº£ lá»i]
```

## ğŸ§  VÃ­ dá»¥ Ä‘Æ¡n giáº£n:

### âœ… Vector DB Ä‘Ã£ lÆ°u:

| Chunk                                    | Metadata |
| ---------------------------------------- | -------- |
| â€œNhÃ¢n viÃªn thá»­ viá»‡c Ä‘Æ°á»£c nghá»‰ 1 ngÃ yâ€¦â€   | page: 3  |
| â€œNhÃ¢n viÃªn chÃ­nh thá»©c Ä‘Æ°á»£c nghá»‰ 12 ngÃ yâ€ | page: 5  |
| â€œThá»­ viá»‡c tá»‘i Ä‘a lÃ  2 thÃ¡ngâ€             | page: 2  |

### âœ… User há»i:

**"Thá»­ viá»‡c tá»‘i Ä‘a bao lÃ¢u?"**

### ğŸ” CÃ¡c bÆ°á»›c Retrieve:

1. CÃ¢u há»i `"Thá»­ viá»‡c tá»‘i Ä‘a bao lÃ¢u?"` â†’ nhÃºng thÃ nh vector
2. So sÃ¡nh vector cÃ¢u há»i vá»›i vector tá»«ng chunk báº±ng **cosine similarity**
3. Tráº£ vá» **K chunk gáº§n nháº¥t** (thÆ°á»ng Top-3)
4. ÄÆ°a raw text cÃ¡c chunk nÃ y vÃ o LLM â†’ dÃ¹ng lÃ m **context Ä‘á»ƒ tráº£ lá»i**

## ğŸ”§ CÃ´ng thá»©c tÃ­nh Ä‘á»™ giá»‘ng (Cosine Similarity)

$$
\text{similarity}(\vec{q}, \vec{c}) = \frac{\vec{q} \cdot \vec{c}}{|\vec{q}| |\vec{c}|}
$$

Trong Ä‘Ã³:

- $\vec{q} \cdot \vec{c}$: tÃ­ch vÃ´ hÆ°á»›ng (dot product)
- $|\vec{q}|$: Ä‘á»™ dÃ i (norm) cá»§a vector q
- $|\vec{c}|$: Ä‘á»™ dÃ i cá»§a vector c
- GiÃ¡ trá»‹ káº¿t quáº£ náº±m trong khoáº£ng:

  - $-1$: hoÃ n toÃ n ngÆ°á»£c hÆ°á»›ng
  - $0$: vuÃ´ng gÃ³c (khÃ´ng liÃªn quan)
  - $1$: hoÃ n toÃ n giá»‘ng

## âœ… TÃ³m táº¯t

| ThÃ nh pháº§n     | Ã nghÄ©a                                                                  |
| -------------- | ------------------------------------------------------------------------ |
| Input          | CÃ¢u há»i ngÆ°á»i dÃ¹ng                                                       |
| Output         | Danh sÃ¡ch cÃ¡c Ä‘oáº¡n vÄƒn báº£n gáº§n nháº¥t trong Vector DB                      |
| Má»¥c Ä‘Ã­ch       | Cung cáº¥p **context liÃªn quan nháº¥t** Ä‘á»ƒ LLM tráº£ lá»i chÃ­nh xÃ¡c vÃ  ngáº¯n gá»n |
| CÃ´ng nghá»‡ dÃ¹ng | Cosine similarity, FAISS/Qdrant/Weaviate,...                             |

---
