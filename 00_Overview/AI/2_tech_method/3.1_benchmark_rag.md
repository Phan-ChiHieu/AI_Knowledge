# Benchmark RAG

Khi báº¡n triá»ƒn khai há»‡ thá»‘ng RAG, khÃ´ng pháº£i cá»© â€œtÃ¬m Ä‘Æ°á»£c rá»“i Ä‘Æ°a vÃ o LLMâ€ lÃ  Ä‘áº£m báº£o tráº£ lá»i Ä‘Ãºng. Váº«n cÃ³ thá»ƒ gáº·p lá»—i nhÆ°:

- **Tráº£ lá»i sai (hallucination)** dÃ¹ Ä‘Ã£ retrieve Ä‘Ãºng
- **TÃ¬m nháº§m Ä‘oáº¡n liÃªn quan** (`semantic` search kÃ©m)
- **CÃ¢u tráº£ lá»i láº·p, lan man hoáº·c thiáº¿u sÃ³t**

link tham khÃ¡o: https://www.pinecone.io/learn/offline-evaluation/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… WHAT â€“ Benchmark RAG lÃ  gÃ¬?

LÃ  quÃ¡ trÃ¬nh **Ä‘Ã¡nh giÃ¡ hiá»‡u quáº£ toÃ n bá»™ pipeline RAG**:

Tá»« tÃ¬m kiáº¿m â†’ Ä‘áº¿n sinh cÃ¢u tráº£ lá»i â†’ Ä‘áº¿n Ä‘á»™ chÃ­nh xÃ¡c cuá»‘i cÃ¹ng.

> **ğŸ“Œ Má»¥c tiÃªu: Giáº£m lá»—i, tÄƒng Ä‘á»™ tin cáº­y, tÄƒng Ä‘á»™ chÃ­nh xÃ¡c**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… WHY â€“ Táº¡i sao cáº§n benchmark RAG?

RAG lÃ  **tá»• há»£p 2 mÃ´-Ä‘un AI tÃ¡ch biá»‡t:**

- ğŸ“¥ Retrieval (tÃ¬m dá»¯ liá»‡u)
- ğŸ§  Generation (sinh cÃ¢u tráº£ lá»i)

Náº¿u khÃ´ng Ä‘o lÆ°á»ng rÃµ:

- **Báº¡n khÃ´ng biáº¿t lá»—i xáº£y ra á»Ÿ Ä‘Ã¢u** (retrieval hay LLM)
- **Báº¡n khÃ´ng biáº¿t cáº§n cáº£i thiá»‡n pháº§n nÃ o** (embedding? chunking? prompt?)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… HOW â€“ Benchmark RAG: Äo cÃ¡i gÃ¬?

### âœ³ï¸ CÃ³ 3 cáº¥p Ä‘á»™ Ä‘o lÆ°á»ng:

### 1. ğŸ“¥ Äo Retrieval â€“ Äo xem tÃ¬m Ä‘oáº¡n cÃ³ Ä‘Ãºng khÃ´ng?

| Metric                   | Ã nghÄ©a                                                |
| ------------------------ | ------------------------------------------------------ |
| **Recall\@k**            | Trong top-k káº¿t quáº£ retrieve, cÃ³ chá»©a Ä‘oáº¡n Ä‘Ãºng khÃ´ng? |
| **Precision\@k**         | Trong top-k, bao nhiÃªu Ä‘oáº¡n thá»±c sá»± liÃªn quan?         |
| **Embedding similarity** | Vector cÃ¢u há»i gáº§n vector chunk Ä‘Ãºng khÃ´ng?            |

âœ… â†’ Náº¿u retrieve sai â†’ cáº§n cáº£i thiá»‡n chunking, embedding, vector search

---

### 2. ğŸ§  Äo Generation â€“ LLM cÃ³ dÃ¹ng Ä‘Ãºng dá»¯ liá»‡u Ä‘á»ƒ tráº£ lá»i khÃ´ng?

| Metric                             | Ã nghÄ©a                                         |
| ---------------------------------- | ----------------------------------------------- |
| **Faithfulness (tÃ­nh trung thá»±c)** | Tráº£ lá»i cÃ³ bÃ¡m sÃ¡t dá»¯ liá»‡u Ä‘Æ°á»£c retrieve khÃ´ng? |
| **Factuality (tÃ­nh chÃ­nh xÃ¡c)**    | CÃ³ nÃ³i sai sá»± tháº­t khÃ´ng?                       |
| **TÃ­nh Ä‘áº§y Ä‘á»§**                    | Tráº£ lá»i cÃ³ Ä‘á»§ thÃ´ng tin khÃ´ng, hay thiáº¿u?       |

âœ… â†’ Náº¿u LLM bá»‹a â†’ cáº§n Ä‘iá»u chá»‰nh prompt, giáº£m Ä‘á»™ "tÆ°á»Ÿng tÆ°á»£ng"

---

### 3. ğŸ§ª Äo tá»•ng thá»ƒ â€“ CÃ¢u tráº£ lá»i cÃ³ tá»‘t khÃ´ng?

| Metric                     | Ã nghÄ©a                                          |
| -------------------------- | ------------------------------------------------ |
| **EM (Exact Match)**       | CÃ¢u tráº£ lá»i cÃ³ trÃ¹ng hoÃ n toÃ n vá»›i ground truth? |
| **ROUGE, BLEU, BERTScore** | So sÃ¡nh Ä‘á»™ giá»‘ng ngá»¯ nghÄ©a vá»›i Ä‘Ã¡p Ã¡n chuáº©n      |
| **Human Eval**             | Con ngÆ°á»i cháº¥m Ä‘iá»ƒm: Ä‘Ãºng, rÃµ, Ä‘áº§y Ä‘á»§, tá»± tin    |

âœ… â†’ ÄÃ¢y lÃ  Ä‘Ã¡nh giÃ¡ cháº¥t lÆ°á»£ng thá»±c táº¿

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… Má»™t lá»—i ráº¥t phá»• biáº¿n trong RAG:

> TÃ¬m Ä‘Ãºng Ä‘oáº¡n â€“ nhÆ°ng GPT khÃ´ng dÃ¹ng, váº«n bá»‹a

### LÃ½ do:

- Prompt khÃ´ng nháº¥n máº¡nh: "Chá»‰ Ä‘Æ°á»£c tráº£ lá»i tá»« context"
- GPT thÃ­ch â€œsÃ¡ng táº¡oâ€, Ä‘áº·c biá»‡t vá»›i prompt má»Ÿ
- LLM khÃ´ng biáº¿t Ä‘Ã¡nh giÃ¡ Ä‘á»™ tin cáº­y cá»§a Ä‘oáº¡n retrieved

### ğŸ›  CÃ¡ch xá»­ lÃ½:

- DÃ¹ng prompt dáº¡ng:

  > "DÆ°á»›i Ä‘Ã¢y lÃ  thÃ´ng tin tÃ i liá»‡u. **Tráº£ lá»i chá»‰ dá»±a vÃ o thÃ´ng tin dÆ°á»›i**, náº¿u khÃ´ng Ä‘á»§ thÃ¬ tráº£ lá»i **'TÃ´i khÃ´ng cháº¯c'**."

- Hoáº·c dÃ¹ng mÃ´ hÃ¬nh kiá»ƒm tra faithfulness sau khi sinh ra cÃ¢u tráº£ lá»i

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… Káº¿t há»£p: Retrieval QA Evaluation Pipelines

Má»™t flow benchmark Ä‘Æ¡n giáº£n:

```bash
1. Input: CÃ¢u há»i + Ground Truth Answer
2. Embedding â†’ Semantic Search â†’ Top-K Ä‘oáº¡n
3. Check: cÃ³ chá»©a Ä‘oáº¡n Ä‘Ãºng khÃ´ng? (Recall@k)
4. Prompt LLM sinh cÃ¢u tráº£ lá»i
5. Check: cÃ¢u tráº£ lá»i cÃ³ Ä‘Ãºng khÃ´ng? (EM, BLEU, Faithfulness)
```

Báº¡n cÃ³ thá»ƒ dÃ¹ng:

- **LangChain Benchmarks**
- **Ragas (from RAGEval)**
- **Custom pipeline + human review**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” âˆ˜â—¦ âœ§ âœ¦ âœ§ â—¦âˆ˜ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âœ… TÃ³m táº¯t 80/20:

| Cáº¥p Ä‘o        | Äo gÃ¬?                     | Tá»‘i Æ°u gÃ¬?                     |
| ------------- | -------------------------- | ------------------------------ |
| ğŸ“¥ Retrieval  | TÃ¬m Ä‘Ãºng Ä‘oáº¡n khÃ´ng?       | Embedding, chunking, vector DB |
| ğŸ§  Generation | DÃ¹ng Ä‘Ãºng thÃ´ng tin khÃ´ng? | Prompt, LLM behavior           |
| âœ… Tá»•ng thá»ƒ   | CÃ¢u tráº£ lá»i cÃ³ Ä‘Ãºng khÃ´ng? | Cáº£ 2 pháº§n trÃªn                 |
